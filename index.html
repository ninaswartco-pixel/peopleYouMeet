<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>The People You Meet | Carla Schultz</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="stylesheet" href="css/styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@200;400;700;800&amp;family=Dancing+Script:wght@700&amp;family=Great+Vibes&amp;family=Italiana&amp;family=Playfair+Display:wght@400;700&amp;family=Cormorant+Garamond:wght@400;600&amp;family=Montserrat:wght@200;300;400;500&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
      rel="stylesheet"
    />
    <script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#13c8ec",
              "background-dark": "#101f22",
            },
            fontFamily: {
              display: "Manrope",
              script: ["Dancing Script", "cursive"],
            },
          },
        },
      };
    </script>
    <style type="text/tailwindcss">
      :root {
        --burnt-orange-transparent: rgba(184, 84, 11, 0.6);
      }
      body {
        font-family: "Manrope", sans-serif;
        background-color: #000;
      }
      .accent-text {
        color: var(--burnt-orange-transparent) !important;
        transition: none !important;
      }
      .secret-author {
        color: var(--burnt-orange-transparent) !important;
        transition: none !important;
        text-decoration: none !important;
      }
      .secret-author:hover {
        color: var(--burnt-orange-transparent) !important;
        opacity: 1 !important;
        cursor: default;
        text-decoration: none !important;
      }
      .hero-bg {
        background-size: cover;
        background-position: center;
      }
      /* Loading state */
      .loading-content {
        opacity: 0;
        transition: opacity 0.3s ease-in;
      }
      .content-loaded {
        opacity: 1;
      }
      .fancy-entries-link {
        background: none;
        box-shadow: 0 2px 16px 0 rgba(184, 84, 11, 0.08);
        transition: border-color 0.2s, color 0.2s, box-shadow 0.2s, width 0.2s;
        min-width: 10rem;
        display: inline-block;
        text-align: center;
      }
      .fancy-entries-link:hover {
        border-bottom: 2px solid #fff;
        color: #fff;
        box-shadow: 0 4px 24px 0 rgba(184, 84, 11, 0.18);
        min-width: 12rem;
      }
      .fancy-entries-link:active {
        border-bottom: 2px solid #fff;
        color: #fff;
        box-shadow: 0 6px 32px 0 rgba(184, 84, 11, 0.32);
        min-width: 12rem;
      }
    </style>
    <style>
      input:-webkit-autofill,
      input:-webkit-autofill:focus,
      input:-webkit-autofill:hover,
      input:-webkit-autofill:active {
        -webkit-box-shadow: 0 0 0 1000px #7c4a1e99 inset !important;
        box-shadow: 0 0 0 1000px #7c4a1e99 inset !important;
        background-color: #7c4a1e99 !important;
        color: #3a1f0b !important;
        -webkit-text-fill-color: #3a1f0b !important;
        caret-color: #3a1f0b !important;
      }
    </style>
  </head>
  <body class="text-white overflow-hidden">
    <!-- Loading Spinner -->
    <div
      id="loading-spinner"
      class="fixed inset-0 bg-black flex items-center justify-center z-50"
    >
      <div
        class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-white"
      ></div>
    </div>
    <main
      class="loading-content relative h-screen w-full flex items-center justify-center overflow-hidden"
    >
      <div class="absolute inset-0 hero-bg">
        <div class="absolute inset-0 bg-black/20"></div>
      </div>
      <div class="relative z-10 w-full max-w-6xl px-6">
        <div class="text-center flex flex-col items-center gap-4">
          <div class="space-y-1">
            <h1
              class="text-white text-6xl md:text-8xl font-script leading-tight drop-shadow-2xl select-none"
              style="
                word-break: keep-all;
                hyphens: none;
                min-height: 1.2em;
                text-shadow: 2px 4px 12px rgba(44, 24, 8, 0.25);
              "
            ></h1>
            <div class="flex items-center justify-center">
              <a
                id="openLoginLink"
                class="secret-author font-display text-lg md:text-xl tracking-[0.1em] select-none"
                href="#"
              >
              </a>
            </div>
          </div>
          <div class="mt-12">
            <a
              class="group flex flex-col items-center gap-3"
              href="entries.html"
            >
              <span
                class="fancy-entries-link text-white text-sm font-light tracking-[0.4em] lowercase border-b border-white/40 pb-2 px-4 rounded-lg transition-all duration-200 cursor-pointer"
                style="position: relative; z-index: 1"
              >
                read entries
              </span>
            </a>
          </div>
        </div>
      </div>
      <div
        class="absolute bottom-12 left-1/2 -translate-x-1/2 flex flex-col items-center gap-3 opacity-40"
      >
        <div class="w-px h-16 bg-gradient-to-b from-white to-transparent"></div>
      </div>
    </main>
    <div
      class="fixed inset-0 z-[100] bg-black/80 backdrop-blur-md flex items-center justify-center p-6 opacity-0 pointer-events-none transition-opacity duration-300"
    >
      <div
        class="relative w-full max-w-3xl bg-[#101f22]/60 backdrop-blur-xl border border-white/10 rounded-xl overflow-hidden shadow-2xl"
      >
        <div class="grid md:grid-cols-2">
          <div
            class="h-64 md:h-auto bg-cover bg-center"
            style="
              background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuCflFUXmcHkQwD03NtcqbQLEx2Sme89yaY6beQU3B6cVSbypE3KTRUdbDoaMpBwa5ie7L5xfDH1qi9keBTXi9rBFEHObDvNaSjl6BEDBk2JcDRdjR5ed5wtFu1aRxUl4ljP5LLr62hF5j_o9v9VRXA2Jen1XMEhrk05KRJaqBy_8TAIZIWp1EVZjO48WQjq03f7z7FjSBrfz8OgesBylB7QF7ZAUjlbuWhKij_KvvHUAOqCOUuxlYGX9F4GKg-rffs1Y2AgOqa8RnE');
            "
          ></div>
          <div class="p-8 md:p-12 flex flex-col justify-center gap-6">
            <div class="space-y-2">
              <h2
                class="text-xs font-bold tracking-[0.2em] uppercase text-white/50"
              >
                The Author
              </h2>
              <h3
                class="accent-text text-3xl font-bold font-display tracking-tight"
              >
                Carla Schultz
              </h3>
            </div>
            <p class="text-white/70 text-base leading-relaxed font-light">
              Carla is a storyteller capturing the quiet moments between
              strangers. This blog is her digital scrapbook of human resonance.
            </p>
            <div class="flex flex-wrap gap-4 pt-4">
              <button
                class="flex items-center justify-center rounded-lg h-10 px-6 bg-white text-black text-sm font-bold tracking-wide"
              >
                Follow Stories
              </button>
            </div>
          </div>
        </div>
        <button
          class="absolute top-4 right-4 size-10 flex items-center justify-center rounded-full bg-black/20 text-white hover:bg-white hover:text-black transition-all"
        >
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
    </div>
    <script type="module">
      // Load global settings from Firestore and apply to page
      import { db } from "./js/firebase-init.js";
      import {
        doc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

      async function loadGlobalSettings() {
        try {
          const docRef = doc(db, "siteSettings", "global");
          const snap = await getDoc(docRef);
          if (snap.exists()) {
            const data = snap.data();

            // Update title if available
            if (data.siteTitle) {
              document.title =
                data.siteTitle + " | " + (data.siteAuthor || "Carla Schultz");
              const titleEl = document.querySelector("h1");
              if (titleEl) {
                // Apply typewriter effect
                typewriterEffect(titleEl, data.siteTitle, 120);
              }
            }

            // Update author if available
            if (data.siteAuthor) {
              const authorEl = document.querySelector(".secret-author");
              if (authorEl) {
                authorEl.textContent = data.siteAuthor;
              }
            }

            // Update hero background if available - THIS MUST LOAD
            if (data.heroImageUrl) {
              const heroBg = document.querySelector(".hero-bg");
              if (heroBg) {
                // Preload the image before showing content
                const img = new Image();
                img.onload = () => {
                  heroBg.style.backgroundImage =
                    "url(" + data.heroImageUrl + ")";
                  showContent();
                };
                img.onerror = () => {
                  console.error("Failed to load hero image");
                  showContent(); // Still show content even if image fails
                };
                img.src = data.heroImageUrl;
              } else {
                showContent();
              }
            } else {
              showContent();
            }

            // Update theme color if available
            if (data.themeColor) {
              document.documentElement.style.setProperty(
                "--burnt-orange-transparent",
                data.themeColor + "99"
              );
            }

            // Load and apply fonts
            const fontMap = {
              greatVibes: '"Great Vibes", cursive',
              italiana: '"Italiana", serif',
              playfair: '"Playfair Display", serif',
              cormorant: '"Cormorant Garamond", serif',
              montserrat: '"Montserrat", sans-serif',
              crimsonText: '"Crimson Text", serif',
              lora: '"Lora", serif',
              merriweather: '"Merriweather", serif',
              oldStandard: '"Old Standard TT", serif',
              libreBaskerville: '"Libre Baskerville", serif',
            };

            if (data.titleFont) {
              const titleFontFamily =
                fontMap[data.titleFont] || fontMap.greatVibes;
              const titleEl = document.querySelector("h1");
              if (titleEl) titleEl.style.fontFamily = titleFontFamily;
            }

            if (data.authorFont) {
              const authorFontFamily =
                fontMap[data.authorFont] || fontMap.italiana;
              const authorEl = document.querySelector(".secret-author");
              if (authorEl) authorEl.style.fontFamily = authorFontFamily;
            }

            if (data.bodyFont) {
              const bodyFontFamily =
                fontMap[data.bodyFont] || fontMap.montserrat;
              document.body.style.fontFamily = bodyFontFamily;
            }

            console.log("Global settings loaded:", data);
          } else {
            console.log("No global settings found");
            showContent(); // Show content even if no settings
          }
        } catch (e) {
          console.error("Failed to load global settings:", e);
          showContent(); // Show content even on error
        }
      }

      // Typewriter effect function
      function typewriterEffect(element, text, speed = 80) {
        if (!element || !text) return Promise.resolve();

        return new Promise((resolve) => {
          let i = 0;
          element.innerHTML = "";

          // Wrap each line in a span with nowrap and add line break before "along the way" if present
          const formattedText = text.replace(
            /\s+(along the way)/gi,
            '</span><br><span style="white-space: nowrap; display: inline-block;">$1'
          );
          const wrappedText =
            '<span style="white-space: nowrap; display: inline-block;">' +
            formattedText +
            "</span>";

          function type() {
            if (i < wrappedText.length) {
              // Handle HTML tags
              if (wrappedText.charAt(i) === "<") {
                const closingTag = wrappedText.indexOf(">", i);
                if (closingTag !== -1) {
                  element.innerHTML += wrappedText.substring(i, closingTag + 1);
                  i = closingTag + 1;
                  setTimeout(type, 0); // No delay for HTML tags
                  return;
                }
              }
              element.innerHTML += wrappedText.charAt(i);
              i++;
              setTimeout(type, speed);
            } else {
              resolve();
            }
          }

          type();
        });
      }

      // Function to show content and hide loading spinner
      function showContent() {
        const spinner = document.getElementById("loading-spinner");
        const main = document.querySelector("main");

        if (spinner) {
          spinner.style.display = "none";
        }
        if (main) {
          main.classList.remove("loading-content");
          main.classList.add("content-loaded");
        }
      }

      loadGlobalSettings();
    </script>
    <!-- Login Modal HTML -->
    <div
      id="login-modal"
      class="hidden fixed inset-0 z-[200] bg-white/40 backdrop-blur-sm flex items-center justify-center p-6 transition-opacity duration-300"
    >
      <div
        class="relative shadow-2xl p-4 flex flex-col gap-3 border border-slate-200 text-[#3a1f0b]"
        style="
          background: linear-gradient(135deg, #4e2e0e 0%, #7c4a1e 100%);
          box-shadow: 0 8px 32px 0 rgba(78, 46, 14, 0.4);
          border: 4px solid #7c4a1e;
          border-radius: 0;
          width: auto;
          min-width: 0;
          max-width: none;
        "
      >
        <button
          id="login-modal-close"
          type="button"
          class="absolute top-3 right-3 w-8 h-8 flex items-center justify-center rounded-full bg-black/10 text-black hover:bg-black/20 focus:outline-none"
        >
          <span style="font-size: 1.5rem; line-height: 1">&times;</span>
        </button>
        <h2 class="text-xl font-bold text-center mb-2" style="color: #3a1f0b">
          The Secret Writing Room
        </h2>
        <form id="login-form" class="flex flex-col gap-4">
          <input
            id="login-email"
            type="email"
            placeholder="The Secret Word"
            autocomplete="username"
            required
            class="border border-[#7c4a1e] px-3 py-2 focus:border-[#4e2e0e] focus:outline-none text-[#3a1f0b] placeholder-[#7c4a1e] bg-[#7c4a1e]/60 rounded-none"
            style="background-color: #7c4a1e99; color: #3a1f0b"
          />
          <input
            id="login-password"
            type="password"
            placeholder="Writing Key"
            autocomplete="current-password"
            required
            class="border border-[#7c4a1e] px-3 py-2 focus:border-[#4e2e0e] focus:outline-none text-[#3a1f0b] placeholder-[#7c4a1e] bg-[#7c4a1e]/60 rounded-none"
            style="background-color: #7c4a1e99; color: #3a1f0b"
          />
          <button
            type="submit"
            class="font-bold py-2 rounded-none transition text-[#3a1f0b] hover:underline bg-transparent border-none shadow-none"
            style="background: none; border: none; box-shadow: none"
          >
            Let Me In
          </button>
        </form>
        <div
          id="login-message"
          class="text-center text-sm"
          style="color: #3a1f0b; min-height: 1.5em"
        ></div>
      </div>
    </div>
    <!-- Scripts: Firebase Init, Login Modal, then scripts.js -->
    <script type="module" src="js/firebase-init.js"></script>
    <script type="module" src="js/login-modal.js"></script>
    <script src="js/scripts.js"></script>
  </body>
</html>
